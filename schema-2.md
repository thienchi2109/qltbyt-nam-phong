create table public.ke_hoach_bao_tri (
  id bigint generated by default as identity not null,
  created_at timestamp with time zone not null default now(),
  ten_ke_hoach text not null,
  nam integer not null,
  khoa_phong text null,
  trang_thai text not null default 'Bản nháp'::text,
  ngay_phe_duyet timestamp with time zone null,
  nguoi_lap_ke_hoach text null,
  loai_cong_viec text null,
  ly_do_khong_duyet text null,
  nguoi_duyet text null,
  don_vi bigint null,
  constraint ke_hoach_bao_tri_pkey primary key (id),
  constraint ke_hoach_bao_tri_don_vi_fkey foreign KEY (don_vi) references don_vi (id)
) TABLESPACE pg_default;

create index IF not exists idx_ke_hoach_bao_tri_nam on public.ke_hoach_bao_tri using btree (nam) TABLESPACE pg_default;

create index IF not exists idx_ke_hoach_bao_tri_trang_thai on public.ke_hoach_bao_tri using btree (trang_thai) TABLESPACE pg_default;

create index IF not exists idx_ke_hoach_bao_tri_created_at on public.ke_hoach_bao_tri using btree (created_at) TABLESPACE pg_default;

create index IF not exists idx_ke_hoach_bao_tri_year_status on public.ke_hoach_bao_tri using btree (nam, trang_thai) TABLESPACE pg_default;

create index IF not exists idx_ke_hoach_bao_tri_don_vi_active on public.ke_hoach_bao_tri using btree (don_vi) TABLESPACE pg_default
where
  (don_vi is not null);

create index IF not exists idx_ke_hoach_bao_tri_don_vi on public.ke_hoach_bao_tri using btree (don_vi) TABLESPACE pg_default;

create table public.cong_viec_bao_tri (
  id bigint generated by default as identity not null,
  created_at timestamp with time zone not null default now(),
  ke_hoach_id bigint not null,
  thiet_bi_id bigint null,
  loai_cong_viec text null,
  diem_hieu_chuan text null,
  don_vi_thuc_hien text null,
  thang_1 boolean null default false,
  thang_2 boolean null default false,
  thang_3 boolean null default false,
  thang_4 boolean null default false,
  thang_5 boolean null default false,
  thang_6 boolean null default false,
  thang_7 boolean null default false,
  thang_8 boolean null default false,
  thang_9 boolean null default false,
  thang_10 boolean null default false,
  thang_11 boolean null default false,
  thang_12 boolean null default false,
  ghi_chu text null,
  thang_1_hoan_thanh boolean null default false,
  thang_2_hoan_thanh boolean null default false,
  thang_3_hoan_thanh boolean null default false,
  thang_4_hoan_thanh boolean null default false,
  thang_5_hoan_thanh boolean null default false,
  thang_6_hoan_thanh boolean null default false,
  thang_7_hoan_thanh boolean null default false,
  thang_8_hoan_thanh boolean null default false,
  thang_9_hoan_thanh boolean null default false,
  thang_10_hoan_thanh boolean null default false,
  thang_11_hoan_thanh boolean null default false,
  thang_12_hoan_thanh boolean null default false,
  ngay_hoan_thanh_1 timestamp with time zone null,
  ngay_hoan_thanh_2 timestamp with time zone null,
  ngay_hoan_thanh_3 timestamp with time zone null,
  ngay_hoan_thanh_4 timestamp with time zone null,
  ngay_hoan_thanh_5 timestamp with time zone null,
  ngay_hoan_thanh_6 timestamp with time zone null,
  ngay_hoan_thanh_7 timestamp with time zone null,
  ngay_hoan_thanh_8 timestamp with time zone null,
  ngay_hoan_thanh_9 timestamp with time zone null,
  ngay_hoan_thanh_10 timestamp with time zone null,
  ngay_hoan_thanh_11 timestamp with time zone null,
  ngay_hoan_thanh_12 timestamp with time zone null,
  updated_at timestamp with time zone null default now(),
  constraint cong_viec_bao_tri_pkey primary key (id),
  constraint cong_viec_bao_tri_ke_hoach_id_fkey foreign KEY (ke_hoach_id) references ke_hoach_bao_tri (id) on delete CASCADE,
  constraint cong_viec_bao_tri_thiet_bi_id_fkey foreign KEY (thiet_bi_id) references thiet_bi (id) on delete set null
) TABLESPACE pg_default;

create index IF not exists idx_cong_viec_bao_tri_ke_hoach_id on public.cong_viec_bao_tri using btree (ke_hoach_id) TABLESPACE pg_default;

create index IF not exists idx_cong_viec_bao_tri_thiet_bi_id on public.cong_viec_bao_tri using btree (thiet_bi_id) TABLESPACE pg_default;

create trigger update_cong_viec_bao_tri_updated_at BEFORE
update on cong_viec_bao_tri for EACH row
execute FUNCTION update_updated_at_column ();